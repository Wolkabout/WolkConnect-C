
\begin{DoxyCode}{0}
\DoxyCodeLine{██╗    ██╗ ██████╗ ██╗     ██╗  ██╗ ██████╗ ██████╗ ███╗   ██╗███╗   ██╗███████╗ ██████╗████████╗  }
\DoxyCodeLine{██║    ██║██╔═══██╗██║     ██║ ██╔╝██╔════╝██╔═══██╗████╗  ██║████╗  ██║██╔════╝██╔════╝╚══██╔══╝  }
\DoxyCodeLine{██║ █╗ ██║██║   ██║██║     █████╔╝ ██║     ██║   ██║██╔██╗ ██║██╔██╗ ██║█████╗  ██║        ██║     }
\DoxyCodeLine{██║███╗██║██║   ██║██║     ██╔═██╗ ██║     ██║   ██║██║╚██╗██║██║╚██╗██║██╔══╝  ██║        ██║     }
\DoxyCodeLine{╚███╔███╔╝╚██████╔╝███████╗██║  ██╗╚██████╗╚██████╔╝██║ ╚████║██║ ╚████║███████╗╚██████╗   ██║     }
\DoxyCodeLine{ ╚══╝╚══╝  ╚═════╝ ╚══════╝╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚═╝  ╚═══╝╚═╝  ╚═══╝╚══════╝ ╚═════╝   ╚═╝     }
\DoxyCodeLine{                                                                                                   }
\DoxyCodeLine{                                                                                            ██████╗}
\DoxyCodeLine{                                                                                           ██╔════╝}
\DoxyCodeLine{                                                                                     █████╗██║     }
\DoxyCodeLine{                                                                                     ╚════╝██║     }
\DoxyCodeLine{                                                                                           ╚██████╗}
\DoxyCodeLine{                                                                                            ╚═════╝}
\end{DoxyCode}


\doxysubsection*{\href{https://travis-ci.com/Wolkabout/WolkConnect-C}{\texttt{ }} }

Wolk\+About C99 Connector library for connecting devices to \href{https://demo.wolkabout.com/\#/login}{\texttt{ Wolk\+About IoT platform}}.

Wolk\+Connect-\/C is transportation layer agnostic which means it is up to the user of the library to open socket to Wolk\+About IoT platform, configure S\+SL if desired, and forward read/write implementation to Wolk\+Connect-\/C Connector. Wolk\+Connect-\/C Connector is not thread safe, and is written with cooperative scheduling in mind. This allows Wolk\+Connect-\/C Connector to work on wide variety of systems, bare metal to OS based ones.

Given examples are intended to be run on Debian based system.

Supported protocol(s)\+:
\begin{DoxyItemize}
\item W\+O\+L\+K\+A\+B\+O\+UT P\+R\+O\+T\+O\+C\+OL
\end{DoxyItemize}

\doxysubsection*{Prerequisite }

Following tools/libraries are required in order to build Wolk\+Connect-\/C Connector


\begin{DoxyItemize}
\item cmake -\/ version 2.\+8 or later
\item libssl-\/dev
\item clang-\/format
\item ruby
\item ceedling
\end{DoxyItemize}

Former can be installed on Debian based system from terminal by invoking

{\ttfamily sudo apt-\/get install cmake libssl-\/dev clang-\/format ruby}

{\ttfamily gem install ceedling}

When dependencies are installed, Unix Makefiles build system can generated by invoking {\ttfamily ./configure}

Generated build system is located inside {\ttfamily build} directory.

Wolk\+Connect-\/C Connector library, and example are built from {\ttfamily build} directory by invoking {\ttfamily make} in terminal.

Library application is built to {\ttfamily out/lib} directory, and example application is built to {\ttfamily out/bin} directory.

\doxysubsection*{Example Usage }

{\bfseries{Initialize Wolk\+Connect-\/C Connector}}

Create a device on Wolk\+About IoT platform using {\ttfamily Simple example} device type. This device type fits \href{https://github.com/Wolkabout/WolkConnect-C/blob/master/examples/simple/main.c}{\texttt{ simple example}} and demonstrates the sending of a temperature sensor reading.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char}* device\_key = \textcolor{stringliteral}{"device\_key"};}
\DoxyCodeLine{\textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char}* device\_password = \textcolor{stringliteral}{"some\_password"};}
\DoxyCodeLine{\textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char}* hostname = \textcolor{stringliteral}{"api-\/demo.wolkabout.com"};}
\DoxyCodeLine{\textcolor{keyword}{static} \textcolor{keywordtype}{int} portno = 8883;}
\DoxyCodeLine{\textcolor{keyword}{static} \textcolor{keywordtype}{char} certs[] = \textcolor{stringliteral}{"../ca.crt"};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/* Sample in-\/memory persistence storage -\/ size 1MB */}}
\DoxyCodeLine{\textcolor{keyword}{static} uint8\_t persistence\_storage[1024*1024];}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/* WolkConnect-\/C Connector context */}}
\DoxyCodeLine{\textcolor{keyword}{static} \mbox{\hyperlink{structwolk__ctx}{wolk\_ctx\_t}} wolk;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//...}}
\DoxyCodeLine{\textcolor{comment}{//...}}
\DoxyCodeLine{\textcolor{comment}{//...}}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{wolk__connector_8h_a607b5439ae7741284a73312b7794fa7a}{wolk\_init}}(\&wolk,                                             \textcolor{comment}{/* Context */}}
\DoxyCodeLine{          send\_buffer,                                       \textcolor{comment}{/* See send\_func\_t */}}
\DoxyCodeLine{          receive\_buffer,                                    \textcolor{comment}{/* See recv\_func\_t */}}
\DoxyCodeLine{          NULL,                                              \textcolor{comment}{/* Actuation handler        -\/ see actuation\_handler\_t */}}
\DoxyCodeLine{          ACTUATOR\_STATE\_READY,                              \textcolor{comment}{/* Actuator status provider -\/ see actuator\_status\_provider\_t */}}
\DoxyCodeLine{      NULL,                                              \textcolor{comment}{/* Configuration handler        -\/ see configuration\_handler\_t */}}
\DoxyCodeLine{      NULL,                                              \textcolor{comment}{/* Configuration provider -\/ see configuration\_provider\_t */}}
\DoxyCodeLine{          device\_key, device\_password,                       \textcolor{comment}{/* Device key and password provided by WolkAbout IoT Platform upon device creation */}}
\DoxyCodeLine{          \mbox{\hyperlink{wolk__connector_8h_a91e19fa4fff461493e1a41f7c7aa4e5fa89c4c17a8daf807a743d09db8f510198}{PROTOCOL\_WOLKABOUT}},                              \textcolor{comment}{/* Protocol specified for device */}}
\DoxyCodeLine{          NULL,                                              \textcolor{comment}{/* Array of actuator references */}}
\DoxyCodeLine{          NULL);                                             \textcolor{comment}{/* Number of actuator references */}}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{wolk__connector_8h_a0fbb983c6b65072501b078ba6ff8e5ad}{wolk\_init\_in\_memory\_persistence}}(\&wolk,                       \textcolor{comment}{/* Context */}}
\DoxyCodeLine{                                persistence\_storage,         \textcolor{comment}{/* Address to start of the memory which will be used by persistence mechanism */}}
\DoxyCodeLine{                                \textcolor{keyword}{sizeof}(persistence\_storage), \textcolor{comment}{/* Size of memory in bytes */}}
\DoxyCodeLine{                                \textcolor{keyword}{true});                       \textcolor{comment}{/* If storage is full overwrite oldest item when pushing */}}
\end{DoxyCode}


Considering that Wolk\+Connect C Connector is transportation layer agnostic, it is up to the user of it to open connection to Wolk\+About IoT Platform, optionally setup T\+LS, and forward read/write callbacks Wolk\+Connect-\/C Connector in initialization step.

See {\ttfamily send\+\_\+func\+\_\+t} and {\ttfamily send\+\_\+func\+\_\+t} in {\ttfamily \mbox{\hyperlink{wolk__connector_8h}{sources/wolk\+\_\+connector.\+h}}}

{\bfseries{Establishing connection with Wolk\+About IoT platform\+:}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{wolk__connector_8h_ab246fad03ad57f3efe89f4ec2c93a288}{wolk\_connect}}(\&wolk);}
\end{DoxyCode}


{\bfseries{Adding sensor readings\+:}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{wolk__connector_8h_a64154eab0e59523055735f1c01cbd9ca}{wolk\_add\_numeric\_sensor\_reading}}(\&wolk, \textcolor{stringliteral}{"T"}, 23.4, 0);}
\end{DoxyCode}


{\bfseries{Data publish strategy\+:}}

Sensor reading is pushed to Wolk\+About IoT platform on demand by calling 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{wolk__connector_8h_ac5e7ddb346ea4b9a7cc4511d3728be09}{wolk\_publish}}(\&wolk);}
\end{DoxyCode}


{\bfseries{Cooperative scheduling\+:}}

Fuction {\ttfamily wolk\+\_\+process(wolk\+\_\+ctx\+\_\+t $\ast$ctx)} is non-\/blocking in order to comply with cooperative scheduling, and it must to be called periodically.


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{wolk__connector_8h_adcdceef8506309d355cb12f305f99936}{wolk\_process}}(\&wolk, 5);}
\end{DoxyCode}


{\bfseries{Disconnecting from the platform\+:}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{wolk__connector_8h_af174943365b8cddc1e6e9351996805c3}{wolk\_disconnect}}(\&wolk);}
\end{DoxyCode}


{\bfseries{Data persistence\+:}}

Wolk\+Connect-\/C provides mechanism for persisting data in situations where readings can not be sent to Wolk\+About IoT platform. Default implementation can work with in-\/memory or memory mapped storage.

Persisted readings are sent to Wolk\+About IoT platform, in batches, on publish function call.

In cases when provided persistence implementation is suboptimal, one can use custom persistence by providing custom implementation.


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{wolk__connector_8h_a4cb5cc0164b0ab19f9b2bf36d28e9913}{wolk\_init\_custom\_persistence}}(\&wolk,}
\DoxyCodeLine{                             persistence\_push\_impl,}
\DoxyCodeLine{                             persistence\_peek\_impl, persistence\_pop\_impl,}
\DoxyCodeLine{                             persistence\_is\_empty\_impl);}
\end{DoxyCode}


For more info on persistence mechanism see {\ttfamily sources/persistence.\+h} and {\ttfamily sources/in\+\_\+memory\+\_\+persistence.\+h} files.

{\bfseries{Additional functionality}}

Wolk\+Connect-\/C library has integrated additional features which can perform full Wolk\+About IoT platform potential. Read more about full feature set example \href{https://github.com/Wolkabout/WolkConnect-C/tree/master/examples/full_feature_set}{\texttt{ H\+E\+RE}}. 